<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>TONTONAN KU</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #0b132b 0%, #1c2541 100%);
      --card: #3a506b;
      --accent: #5bc0be;
      --text: #ffffff;
      --muted: #8d99ae;
      --danger: #e63946;
      --star: #fbbf24;
      --yt: #ff0000;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,sans-serif}
    body{background:var(--bg);color:var(--text);display:flex;min-height:100vh}
    aside{width:320px;background:#0f172a;border-right:1px solid #2a2e45;padding:1rem;display:flex;flex-direction:column}
    aside h2{margin-bottom:.75rem;font-size:1.1rem}
    aside .wrap{display:flex;flex-direction:column;gap:.75rem}
    main{flex:1;padding:1.5rem 1rem;display:flex;flex-direction:column;align-items:center}
    h1{margin-bottom:1rem;font-size:1.5rem;text-align:center}
    .search-bar{position:relative;width:100%;max-width:500px;margin-bottom:1.5rem}
    .search-bar input{width:100%;padding:1rem 1.25rem;border:none;border-radius:50px;background:#ffffff1a;color:var(--text);font-size:1rem;text-align:center}
    .search-bar input:focus{outline:none;background:#ffffff26}
    .search-bar button{position:absolute;right:4px;top:4px;height:calc(100% - 8px);padding:0 1.5rem;border:none;border-radius:50px;background:var(--accent);color:#000;font-weight:600;cursor:pointer}
    .results,.wrap{display:flex;flex-direction:column;gap:1rem;width:100%}
    .card{display:flex;gap:1rem;background:var(--card);border-radius:12px;padding:1rem;transition:transform .2s}
    .card:hover{transform:translateY(-4px)}
    .card img{width:90px;height:135px;object-fit:cover;border-radius:8px;flex-shrink:0}
    .info{flex:1;display:flex;flex-direction:column;justify-content:space-between}
    .info h3 a{color:var(--text);text-decoration:none;font-size:1rem;transition:.2s}
    .info h3 a:hover{color:var(--accent)}
    .info p{margin:.15rem 0;font-size:.8rem;color:var(--muted)}
    .btn-mini{width:279.36px;height:23px;border:none;border-radius:4px;font-size:.7rem;line-height:23px;cursor:pointer;margin-top:.25rem;transition:.2s}
    .btn-add{background:var(--accent);color:#000}
    .btn-add:hover{background:#4ab0ae}
    .btn-remove{background:var(--danger);color:#fff}
    .btn-remove:hover{background:#c33}
    .btn-trailer{background:var(--yt);color:#fff}
    .btn-trailer:hover{background:#c00}
    .star{color:#d1d5db;font-size:.9rem;cursor:pointer}
    .star.active{color:var(--star)}
    .load-more{display:block;margin:1.5rem auto;padding:.5rem 1.4rem;background:var(--accent);color:#000;border:none;border-radius:50px;cursor:pointer;font-weight:600}
    .hidden{display:none}
    @media(max-width:700px){body{flex-direction:column}aside{width:100%;border-right:none;border-bottom:1px solid #2a2e45}}
  </style>
</head>
<body>

  <!-- SIDEBAR : SUDAH DITONTON (NO SCROLL) -->
  <aside>
    <h2>Sudah Ditonton</h2>
    <div class="wrap" id="watchlistItems"></div>
  </aside>

  <!-- MAIN : PENCARIAN DI TENGAH -->
  <main>
    <h1>TONTONAN KU</h1>
    <div class="search-bar">
      <input id="keyword" type="text" placeholder="Cari film…" />
      <button id="searchBtn">Cari</button>
    </div>

    <div id="results"></div>
    <button id="loadMoreBtn" class="load-more hidden">Load More</button>
  </main>

  <script>
    const API_KEY = 'db560b79';
    const watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];
    let allResults = [];
    let currentIndex = 0;
    const STEP = 5;

    const trID = async t => {
      if (!t || t === 'N/A') return 'Sinopsis tidak tersedia';
      try {
        const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=id&dt=t&q=${encodeURIComponent(t)}`);
        return (await res.json())[0][0][0] || t;
      } catch { return t; }
    };
    const imdbLink = (txt, type = 'name') => {
      const base = type === 'genre' ? 'https://www.imdb.com/search/title/?genres=' : 'https://www.imdb.com/find/?q=';
      return `<a href="${base}${encodeURIComponent(txt)}" target="_blank" rel="noopener">${txt}</a>`;
    };
    const openTrailer = async (title, year) => {
      window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(title + ' ' + year + ' trailer')}`, '_blank');
    };

    document.getElementById('keyword').addEventListener('keydown', e => { if (e.key === 'Enter') searchMovies(); });
    document.getElementById('searchBtn').addEventListener('click', searchMovies);

    async function searchMovies() {
      const kw = document.getElementById('keyword').value.trim();
      if (!kw) return;
      const pages = [1, 2, 3, 4, 5];
      let raw = [];
      for (const p of pages) {
        const res = await fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&s=${encodeURIComponent(kw)}&type=movie&page=${p}`);
        const data = await res.json();
        if (data.Response === 'True') raw.push(...data.Search); else break;
      }
      const seen = new Set();
      allResults = raw.filter(m => !seen.has(m.imdbID) && seen.add(m.imdbID)).slice(0, 50);
      currentIndex = 0;
      renderResults(true);
    }

    async function renderResults(clear = true) {
      const box = document.getElementById('results');
      const btn = document.getElementById('loadMoreBtn');
      if (clear) box.innerHTML = '';

      const slice = allResults.slice(currentIndex, currentIndex + STEP);
      for (const m of slice) {
        const d = await (await fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&i=${m.imdbID}&plot=short`)).json();
        const plot = await trID(d.Plot);
        const actors = d.Actors !== 'N/A' ? d.Actors.split(',').slice(0, 5).map(a => imdbLink(a.trim())).join(', ') : 'Tidak tersedia';
        const genres = d.Genre !== 'N/A' ? d.Genre.split(',').slice(0, 5).map(g => imdbLink(g.trim(), 'genre')).join(', ') : 'Tidak tersedia';
        const director = d.Director !== 'N/A' ? imdbLink(d.Director.trim()) : 'Tidak tersedia';

        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <img src="${d.Poster !== 'N/A' ? d.Poster : 'https://via.placeholder.com/90x135?text=No+Image'}" alt="${d.Title}">
          <div class="info">
            <h3>${imdbLink(`${d.Title} (${d.Year})`, 'title')}</h3>
            <p><strong>Sutradara:</strong> ${director}</p>
            <p><strong>Pemeran:</strong> ${actors}</p>
            <p><strong>Genre:</strong> ${genres}</p>
            <p><strong>Sinopsis:</strong> ${plot}</p>
            <button class="btn-mini btn-add" onclick="addToWatchlist('${d.imdbID}')">+ Watchlist</button>
            <button class="btn-mini btn-trailer" onclick="openTrailer('${d.Title}', '${d.Year}')">Trailer</button>
          </div>
        `;
        box.appendChild(el);
      }
      currentIndex += STEP;
      btn.classList.toggle('hidden', currentIndex >= allResults.length);
    }

    document.getElementById('loadMoreBtn').addEventListener('click', () => renderResults(false));

    async function addToWatchlist(id) {
      if (watchlist.some(w => w.id === id)) return; // skip silently
      const d = await (await fetch(`https://www.omdbapi.com/?apikey=${API_KEY}&i=${id}&plot=short`)).json();
      const plot = await trID(d.Plot);
      watchlist.unshift({
        id: d.imdbID,
        title: d.Title,
        year: d.Year,
        poster: d.Poster,
        plot,
        director: d.Director,
        actors: d.Actors,
        genres: d.Genre,
        rating: 0
      });
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
      renderWatchlist();
    }

    function renderWatchlist() {
      const box = document.getElementById('watchlistItems');
      box.innerHTML = watchlist.length
        ? ''
        : '<p style="text-align:center;color:var(--muted)">Belum ada film ditonton</p>';
      watchlist.forEach((m, i) => {
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <img src="${m.poster !== 'N/A' ? m.poster : 'https://via.placeholder.com/90x135?text=No+Image'}" alt="${m.title}">
          <div class="info">
            <h3>${imdbLink(`${m.title} (${m.year})`, 'title')}</h3>
            <p><strong>Sutradara:</strong> ${imdbLink(m.director)}</p>
            <p><strong>Pemeran:</strong> ${m.actors.split(',').map(a => imdbLink(a.trim())).join(', ')}</p>
            <p><strong>Genre:</strong> ${m.genres.split(',').map(g => imdbLink(g.trim(), 'genre')).join(', ')}</p>
            <p><strong>Sinopsis:</strong> ${m.plot}</p>
            <div>${[...Array(5)].map((_, idx) =>
              `<span class="star ${idx < m.rating ? 'active' : ''}" onclick="rate(${i}, ${idx + 1})">★</span>`
            ).join('')}</div>
            <button class="btn-mini btn-remove" onclick="remove(${i})">Hapus</button>
            <button class="btn-mini btn-trailer" onclick="openTrailer('${m.title}', '${m.year}')">Trailer</button>
          </div>
        `;
        box.appendChild(el);
      });
    }

    function rate(i, stars) {
      watchlist[i].rating = stars;
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
      renderWatchlist();
    }
    function remove(i) {
      watchlist.splice(i, 1);
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
      renderWatchlist();
    }

    renderWatchlist();
  </script>
</body>
</html>
